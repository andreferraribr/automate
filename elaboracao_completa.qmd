---
title: "Elaboração dos Relatórios"
editor: visual
lang: "pt"
format:
  # docx: default
  html:
    code-fold: true
    code-summary: "mostrar o código"
    code-overflow: wrap
execute:
  warning: false
  message: false
---

```{r}
#| warning: false
#| message: false
#| error: false
library(readxl)
library(tidyverse)
library(janitor)
library(lubridate)
library(tidyverse)
library(purrr)
library(plotly)
library(knitr)
library(kableExtra)
library(DescTools)
library(zoo)
library(stringr)
library(DT)
library(stringr)
library(scales)
library(ggthemes)

`%notin%` <- Negate(`%in%`)
myNumFmt <- as.fmt(digits=2, big.mark=".")
options(scipen = 999)

options(DT.options = 
          list(
            pageLength = 30,
            language = list(url = '//cdn.datatables.net/plug-ins/1.10.11/i18n/Portuguese.json')
            )
        )
# https://rstudio.github.io/DT/004-i18n.html
# https://rstudio.github.io/DT/options.html
# %>% formatCurrency(c('A', 'C')) %>% formatPercentage('D', 2)%>% formatRound('E', 3)


```

{{< include importar_arquivos.qmd >}}

## Séries Históricas

### Receita por natureza da receita

```{r receita_por_natureza}


datatable(
  dados_receita%>%filter(mes_lancamento == "DEZ/2024") %>% 
  filter(nre1_categoria_economica_codigo %notin% c(7, 8)) %>%
  group_by(nre2_origem_receita_codigo_origem, nre2_origem_receita_nome, natureza_receita_codigo_completo, natureza_receita_nome, item_informacao) %>% pivot_wider(names_from = item_informacao, values_from = saldo_r_item_informacao) %>%
  summarise_at(itens_receita, sum, na.rm = TRUE) %>% adorn_totals("row"), rownames = FALSE)%>% formatRound(itens_receita, 2, mark = ".", dec.mark = "," )%>% 
  DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')

datatable(zzz%>% adorn_totals("row"), rownames = FALSE)%>% formatRound(itens_despesa, 2, mark = ".", dec.mark = "," )%>% 
    DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')

 
```

### Receita para categoria e origem (exceto refinanciamento)

```{r receita_categoria_origem_exceto_refinanciamento}

# datatable(
#   dados_receita%>%head(-1) %>% 
#   clean_names() %>%
#   filter(nre1_categoria_economica_codigo %notin% c(7, 8) & natureza_receita_codigo_completo %notin% c(81110201,21110201,21210201)) %>%
#   group_by(nre1_categoria_economica_codigo, nre1_categoria_economica_nome, nre2_origem_receita_codigo_origem, nre2_origem_receita_nome)  %>%
#   summarise(receita_liquida = sum(receita_orcamentaria_liquida, na.rm = TRUE)) %>% adorn_totals("row"), rownames = FALSE,
#   colnames = c("Categoria código", "Categoria Nome", "Origem Código", "Origem nome", "Receita líquida"))%>% formatRound("receita_liquida", 2, mark = ".", dec.mark = "," )%>% 
#   DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')




```

### Receita para categoria e origem (refinanciamento)

```{r receita_categoria_origem_refinanciamento }


# 
# datatable(
#   dados_receita%>%head(-1) %>% 
#   clean_names() %>%
#   filter(nre1_categoria_economica_codigo %notin% c(7, 8) & natureza_receita_codigo_completo %in% c(81110201,21110201,21210201)) %>%
#   group_by(nre1_categoria_economica_codigo, nre1_categoria_economica_nome, nre2_origem_receita_codigo_origem, nre2_origem_receita_nome) %>%
#   summarise(receita_liquida = sum(receita_orcamentaria_liquida, na.rm = TRUE)) %>% adorn_totals("row"), rownames = FALSE,
#   colnames = c("Categoria código", "Categoria Nome", "Origem Código", "Origem nome", "Receita líquida"))%>% formatRound("receita_liquida", 2, mark = ".", dec.mark = "," )%>% 
#   DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')





```

### Receita para categoria e origem (completo)

```{r filtros_receita_refinanciamento_intra}
receita_refinanciamento <- c(81110201,21110201,21210201)
receita_intra <- c(7, 8)
```

```{r receita_categoria_origem_rbind}


datatable(
 dados_receita %>%
   filter(
     mes_lancamento == "DEZ/2024",
     item_informacao %in% c("PREVISAO ATUALIZADA DA RECEITA","RECEITA ORCAMENTARIA (LIQUIDA)"),
     tipo_modalidade != "intra") %>%
   group_by(
     refinanciamento,
     tipo_modalidade,
     nre1_categoria_economica_codigo,
     nre1_categoria_economica_nome,
     nre2_origem_receita_codigo_origem,
     nre2_origem_receita_nome) %>%
   pivot_wider(
     names_from = item_informacao,
     values_from = saldo_r_item_informacao) %>%
   summarise_at(
     c("PREVISAO ATUALIZADA DA RECEITA","RECEITA ORCAMENTARIA (LIQUIDA)"),
     sum,
     na.rm = TRUE) %>%
   adorn_totals("row"),
 rownames = FALSE) %>%
  formatRound (
    c("PREVISAO ATUALIZADA DA RECEITA","RECEITA ORCAMENTARIA (LIQUIDA)"),
    2,
    mark = ".",
    dec.mark = "," )%>% 
  DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')


```

### Despesa por categoria e grupo

```{r despesa_categoria_grupo_1}
datatable(dados_despesa %>%
 filter(item_informacao == "DESPESAS EMPENHADAS" , !(elemento_despesa_codigo %in% c('76', '77') ) |!(fonte_recursos_codigo == '443' ) | !(subfuncao_governo_codigo %in% c('841', '842', '843', '844', '845', '846'))) %>%
  group_by(categoria_economica_despesa_codigo, categoria_economica_despesa_nome, grupo_despesa_codigo_grupo, grupo_despesa_nome) %>% summarise(despesas_empenhadas = sum(saldo_r_item_informacao, na.rm = TRUE) )  %>% adorn_totals("row"), rownames = FALSE,
  colnames = c("Grupo código", "Grupo Nome", "Despesa Empenhada"))%>% formatRound("despesas_empenhadas", 2, mark = ".", dec.mark = "," )%>% 
  DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')
```

### Despesas de refinanciamento

```{r despesa_categoria_grupo_refinanciamento}
datatable(dados_despesa %>%
 filter(refinanciamento == "sim", item_informacao == "DESPESAS EMPENHADAS") %>%
  group_by(categoria_economica_despesa_codigo, categoria_economica_despesa_nome, grupo_despesa_codigo_grupo, grupo_despesa_nome)  %>% summarise(despesas_empenhadas = sum(saldo_r_item_informacao, na.rm = TRUE) )  %>% adorn_totals("row"), rownames = FALSE,
  colnames = c("Grupo código", "Grupo Nome", "Despesa Empenhada"))%>% formatRound("despesas_empenhadas", 2, mark = ".", dec.mark = "," )%>% 
  DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')
```

### Despesa por UF e Programa

```{r despesa_uf_progama}
tabela(dados_despesa %>% filter(item_informacao == "DESPESAS LIQUIDADAS") %>% group_by(uge_uf_sigla, uge_uf_nome, programa_governo_codigo, programa_governo_nome) %>% summarise(despesas_liquidadas = sum(saldo_r_item_informacao, na.rm = TRUE)), "despesas_liquidadas")
```

### Despesa por UF e Ação

```{r despesa_uf_acao}
tabela(dados_despesa %>% filter(item_informacao == "DESPESAS LIQUIDADAS") %>% group_by(uge_uf_sigla, uge_uf_nome, acao_governo_codigo, acao_governo_nome) %>% summarise(despesas_liquidadas = sum(saldo_r_item_informacao, na.rm = TRUE)), "despesas_liquidadas")
```

### Despesa com irrigação

```{r despesa_irrigacao}
tabela(dados_despesa %>% filter(acao_governo_codigo == "60" , item_informacao == "DESPESAS LIQUIDADAS") %>% group_by(uge_uf_sigla, uge_uf_nome) %>% summarise(despesas_liquidadas = sum(saldo_r_item_informacao, na.rm = TRUE)), "despesas_liquidadas")
```

## RREO

### Anexo 01

#### Despesa categoria e grupo (setdiff)

```{r despesa_categoria_grupo}



# despesa_exceto_refinanciamento <- dados_despesa  %>% 
#                               filter(!( grupo_despesa_codigo_grupo == 6 & elemento_despesa_codigo %in% c(76,77) & subfuncao_governo_codigo %in% c(841, 842, 843, 844, 846) & fonte_recursos_codigo == "443"  ) )
# 
# despesa_refinanciamento <- setdiff(dados_despesa, despesa_exceto_refinanciamento)
# 
# sum(despesa_exceto_refinanciamento$despesas_empenhadas, na.rm = TRUE) + sum(despesa_refinanciamento$despesas_empenhadas, na.rm = TRUE)
# 
# datatable(setdiff(dados_despesa, dados_despesa %>% 
#                     filter(modalidade_aplicacao_codigo != 91) %>% 
#             filter(grupo_despesa_codigo_grupo == 6 &  elemento_despesa_codigo %in% c(76,77) & subfuncao_governo_codigo %in% c(841, 842, 843, 844, 846) & fonte_recursos_codigo == "443"  )) %>% group_by(grupo_despesa_codigo_grupo,grupo_despesa_nome) %>% summarise(despesa_empenhada = sum(despesas_empenhadas, na.rm = TRUE) )  %>% adorn_totals("row"), rownames = FALSE,
#   colnames = c("Grupo código", "Grupo Nome", "Despesa empenhada"))%>% formatRound("despesa_empenhada", 2, mark = ".", dec.mark = "," )%>% 
#   DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')
# 
# 
# datatable(dados_despesa %>% filter( item_informacao == "DESPESAS EMPENHADAS", tipo_modalidade != "intra", refinanciamento == "nao")%>% group_by(grupo_despesa_codigo_grupo,grupo_despesa_nome) %>% summarise(despesa_empenhada = sum(saldo_r_item_informacao, na.rm = TRUE) )  %>% adorn_totals("row"), rownames = FALSE,
#   colnames = c("Grupo código", "Grupo Nome", "Despesa empenhada"))%>% formatRound("despesa_empenhada", 2, mark = ".", dec.mark = "," )%>% 
#   DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')
```

```{r}
# datatable(rbind(despesa_exceto_refinanciamento %>% filter(   modalidade_aplicacao_codigo != c(91)) %>% group_by(grupo_despesa_codigo_grupo,grupo_despesa_nome) %>% summarise(despesas_empenhadas = sum(despesas_empenhadas, na.rm = TRUE) ),despesa_refinanciamento %>%filter(modalidade_aplicacao_codigo != c(91))  %>% group_by(grupo_despesa_codigo_grupo,grupo_despesa_nome) %>% mutate(grupo_despesa_nome = "Refinanciamento") %>% summarise(despesas_empenhadas = sum(despesas_empenhadas, na.rm = TRUE) )) %>%
#    adorn_totals("row"),
#  rownames = FALSE,
#   colnames = 
#    c("Grupo código",
#      "Grupo Nome",
#      "Despesas Empenhadas")
#  ) %>%
#   formatRound (
#     "despesas_empenhadas",
#     2,
#     mark = ".",
#     dec.mark = "," )%>% 
#   DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')


datatable(dados_despesa %>% filter(tipo_modalidade != "intra", item_informacao == "DESPESAS EMPENHADAS") %>% group_by(refinanciamento, grupo_despesa_codigo_grupo, grupo_despesa_nome) %>% summarise(despesa_empenhada = sum(saldo_r_item_informacao, na.rm = TRUE) )  %>% adorn_totals("row"), rownames = FALSE,
  colnames = c("refinanciamento", "Grupo código", "Grupo Nome", "Despesa empenhada"))%>% formatRound("despesa_empenhada", 2, mark = ".", dec.mark = "," )%>% 
  DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')
```

```{r anexo_01}

# anexo_01 <- rbind(
#   despesa_exceto_refinanciamento %>%
#     mutate (
#       tipo_modalidade = ifelse(modalidade_aplicacao_codigo == 91, "intra", "exceto intra")) %>%
#     group_by(tipo_modalidade, grupo_despesa_codigo_grupo,grupo_despesa_nome) %>%
#     summarise(despesas_empenhadas = sum(despesas_empenhadas, na.rm = TRUE) ),
#   despesa_refinanciamento %>%
#     mutate(
#       grupo_despesa_nome = "Refinanciamento",
#       tipo_modalidade = ifelse(modalidade_aplicacao_codigo == 91, "intra", "exceto intra")) %>%
#     group_by(tipo_modalidade, grupo_despesa_codigo_grupo,grupo_despesa_nome) %>%
#     summarise(despesas_empenhadas = sum(despesas_empenhadas, na.rm = TRUE) ))  
# 
# 
# tail(despesa_exceto_refinanciamento, 1)
# 
# anexo_01 <- anexo_01 %>% filter(!is.na(grupo_despesa_codigo_grupo))


datatable(dados_despesa %>% filter(mes_lancamento == "DEZ/2024") %>% group_by(tipo_modalidade, refinanciamento, grupo_despesa_codigo_grupo, grupo_despesa_nome, item_informacao) %>% pivot_wider(names_from = item_informacao, values_from = saldo_r_item_informacao) %>% summarise_at(itens_despesa, sum, na.rm = TRUE) %>% adorn_totals("row"), rownames = FALSE,
  )%>% formatRound(itens_despesa, 2, mark = ".", dec.mark = "," )%>% 
  DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')


```

### Anexo 2

```{r anexo_02_mutate_intra}
datatable(dados_despesa %>% filter(mes_lancamento == "DEZ/2024")%>% filter(refinanciamento == "nao") %>% 
  group_by(  tipo_modalidade, funcao_governo_codigo, funcao_governo_nome, subfuncao_governo_codigo, subfuncao_governo_nome, item_informacao) %>%
  pivot_wider(names_from = item_informacao, values_from = saldo_r_item_informacao)  %>%
    summarise_at(itens_despesa, sum, na.rm = TRUE)%>% adorn_totals("row"), rownames = FALSE,
  )%>% formatRound(itens_despesa, 2, mark = ".", dec.mark = "," )%>% 
  DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')


datatable(dados_despesa %>% filter(mes_lancamento == "DEZ/2024")%>% filter(refinanciamento == "nao") %>% 
  group_by(  tipo_modalidade, funcao_governo_codigo, funcao_governo_nome, item_informacao) %>%
  pivot_wider(names_from = item_informacao, values_from = saldo_r_item_informacao)  %>%
    summarise_at(itens_despesa, sum, na.rm = TRUE)%>% adorn_totals("row"), rownames = FALSE,
  )%>% formatRound(itens_despesa, 2, mark = ".", dec.mark = "," )%>% 
  DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')

```

```{r anexo_02}


# anexo_02 <- anexo_02 %>% filter(!is.na(funcao_governo_codigo))
# 
# tabela(anexo_02 %>% group_by(funcao_governo_codigo, funcao_governo_nome) %>%
#     summarise(despesas_empenhadas = sum(despesas_empenhadas, na.rm = TRUE))  , "despesas_empenhadas")
```

```{r anexo_02_agrupar_intra}

# anexo_02 <- anexo_02 %>% filter(!is.na(funcao_governo_codigo))
# 
# anexo_02_subfuncao <- anexo_02 %>% mutate(
#   funcao_governo_codigo = ifelse(tipo_modalidade == "intra", "intra", funcao_governo_codigo),
#   funcao_governo_nome = ifelse(tipo_modalidade == "intra", "intra", funcao_governo_nome),
#   subfuncao_governo_codigo = ifelse(tipo_modalidade == "intra", "intra", subfuncao_governo_codigo),
#   subfuncao_governo_nome = ifelse(tipo_modalidade == "intra", "intra", subfuncao_governo_nome)
#   ) %>% 
#   group_by(tipo_modalidade, funcao_governo_codigo, funcao_governo_nome, subfuncao_governo_codigo,subfuncao_governo_nome) %>% 
#   summarise(despesas_empenhadas = sum(despesas_empenhadas, na.rm = TRUE))
# 
# 
# tabela(anexo_02_subfuncao  , "despesas_empenhadas")
```

### Tabela 01

#### despesas

```{r tabela_01_despesas}

datatable(dados_despesa %>% filter(mes_lancamento == "DEZ/2024", esfera_orcamentaria_codigo == 2) %>% group_by(tipo_modalidade, refinanciamento, grupo_despesa_codigo_grupo, grupo_despesa_nome, item_informacao) %>% pivot_wider(names_from = item_informacao, values_from = saldo_r_item_informacao) %>% summarise_at(itens_despesa, sum, na.rm = TRUE) %>% adorn_totals("row"), rownames = FALSE,
  )%>% formatRound(itens_despesa, 2, mark = ".", dec.mark = "," )%>% 
  DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')

# tabela_01_despesas <- rbind(
#   despesa_exceto_refinanciamento %>%
#     filter(esfera_orcamentaria_codigo == 2) %>% 
#     group_by(grupo_despesa_codigo_grupo,grupo_despesa_nome) %>%
#     summarise(despesas_empenhadas = sum(despesas_empenhadas, na.rm = TRUE) ),
#   despesa_refinanciamento %>%
#     filter(esfera_orcamentaria_codigo == 2) %>% 
#     group_by( grupo_despesa_codigo_grupo,grupo_despesa_nome) %>%
#     summarise(despesas_empenhadas = sum(despesas_empenhadas, na.rm = TRUE) ))  
# 
# 
# 
# 
# tabela_01_despesas <- tabela_01_despesas %>% filter(!is.na(grupo_despesa_codigo_grupo))
# 
# 
# 
# 
# tabela(tabela_01_despesas , "despesas_empenhadas")

```

#### Receitas

```{r receitas}
# tabela(dados_receita %>% filter(esfera_orcamentaria_codigo == 2) %>% group_by(nre2_origem_receita_codigo_origem, nre2_origem_receita_nome) %>% mutate(nre2_origem_receita_nome = str_remove(nre2_origem_receita_nome, "-INTRA"))%>% summarise(receita_orcamentaria_liquida = sum(receita_orcamentaria_liquida, na.rm = TRUE)), "receita_orcamentaria_liquida")


datatable(
 dados_receita %>%
   filter(
     esfera_orcamentaria_codigo == 2,
     mes_lancamento == "DEZ/2024",
     item_informacao %in% c("PREVISAO ATUALIZADA DA RECEITA","RECEITA ORCAMENTARIA (LIQUIDA)"),
     tipo_modalidade != "intra") %>%
   group_by(
     tipo_modalidade,
     nre1_categoria_economica_codigo,
     nre1_categoria_economica_nome,
     nre2_origem_receita_codigo_origem,
     nre2_origem_receita_nome) %>%
   pivot_wider(
     names_from = item_informacao,
     values_from = saldo_r_item_informacao) %>%
   summarise_at(
     c("PREVISAO ATUALIZADA DA RECEITA","RECEITA ORCAMENTARIA (LIQUIDA)"),
     sum,
     na.rm = TRUE) %>%
   adorn_totals("row"),
 rownames = FALSE) %>%
  formatRound (
    c("PREVISAO ATUALIZADA DA RECEITA","RECEITA ORCAMENTARIA (LIQUIDA)"),
    2,
    mark = ".",
    dec.mark = "," )%>% 
  DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')

```

### Tabela 03

```{r}
datatable(dados_despesa %>% filter(resultado_eof_codigo == 6) %>% group_by(orgao_uge_orgao_maximo_codigo, orgao_uge_orgao_maximo_nome) %>% pivot_wider(names_from = item_informacao, values_from = saldo_r_item_informacao) %>% summarise_at(itens_despesa, sum, na.rm = TRUE) %>% adorn_totals("row"), rownames = FALSE,
  )%>% formatRound(itens_despesa, 2, mark = ".", dec.mark = "," )%>% 
  DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')
```

```{r}
# tabela(dados_receita %>% filter(nre1_categoria_economica_codigo == 1) %>% group_by(nre2_origem_receita_codigo_origem, nre2_origem_receita_nome) %>% summarise(receita_liquida = sum(receita_orcamentaria_liquida, na.rm = TRUE)), "receita_liquida")
```

```{r}
 # tabela(dados_despesa %>% filter(
 #  plano_orcamentario_codigo_po %in% c("0001") &
 #    fonte_recursos_codigo %notin% c(008,035,133,134,213,242 ) &
 #    acao_governo_codigo %in%  c("0E36", "00SB")) %>% group_by(mes_lancamento) %>%
 #  summarise(despesas_empenhadas = sum(despesas_empenhadas, na.rm = TRUE)), "despesas_empenhadas")
 
```

### Tabela 04

```{r importar}



# 621200000 631100000 632100000 111110205 218924001 531710100 531720100 621310000 621320000 621330000 621390000 622920104 631200000 631300000 631400000
# 631510000 631520000 631530000 632200000 632710000 822140101 822240101 894310000 894320000 218914001 111113001
```

```{r tabela_04_linhas}
tabela_04 <- dados_tabela_04 %>%
  mutate( linhas =
    case_when( 
      fonte_recursos_codigo %in% ("000") ~ "0_nao_vinculados",
      fonte_recursos_codigo %in% c("008", "012", "130", "133", "134") ~ "1_educacao",
      fonte_recursos_codigo %in% c("001", "002", "004", "005", "006", "010", "017", "023", "024", "035", "040", "048", "049", "094", "122", "123", "126", "155", "156", "179", "184")  ~ "2_seguridade_exceto_previdencia",
      fonte_recursos_codigo %in% c ("122", "123") & detalhe_orgao_central_codigo_detalhe_oc != "000278" ~ "2_seguridade_exceto_previdencia",
      fonte_recursos_codigo %in% c("055", "056", "125") ~ "3_rpps",
      fonte_recursos_codigo %in% c("054") ~ "4_rgps",
      fonte_recursos_codigo %in% c("400", "401", "443", "444", "448")  ~ "5_divida",
      fonte_recursos_codigo %in% c ("034", "121", "122", "123") & detalhe_orgao_central_codigo_detalhe_oc == "000278" ~ "5_divida",
      fonte_recursos_codigo %in% c("201", "202", "203", "206", "207", "208", "209", "210", "211", "213", "219", "229", "234", "235", "241", "242", "251", "286", "287", "288", "289") ~ "6_transferencias",
      fonte_recursos_codigo %in% c("003", "007", "009", "011", "013", "014", "015", "016", "018", "019", "020", "021", "022", "025", "026", "027", "028", "029", "030", "031", "032", "033", "036", "037", "038", "039", "041", "042", "043", "044", "045", "046", "047", "050", "051", "052", "053", "057", "058", "059", "060", "061", "062", "063", "064", "065", "066", "067", "068", "069", "070", "071", "072", "073", "074", "075", "076", "077", "078", "079", "080", "081", "082", "083", "084", "085", "086", "087", "088", "089", "090", "091", "092", "093", "095", "096", "097", "098", "099", "100", "101", "102", "103", "104", "105", "106", "107", "108", "109", "110", "111", "112", "113", "114", "115", "116", "117", "118", "119", "120", "124", "127", "128", "129", "131", "135", "136", "137", "138", "139", "140", "177", "178", "180", "181", "183", "447", "449")  ~ "7_fundos_orgaos_programa",
      fonte_recursos_codigo %in% c("034", "121") &  detalhe_orgao_central_codigo_detalhe_oc != "000278" ~ "7_fundos_orgaos_programa",
      fonte_recursos_codigo %in% c("491") ~ "8_extraorcamentario",
      fonte_recursos_codigo %in% c("490") ~ "9_nao_classificados",
      TRUE ~ "escape"
    ))
```

```{r tabela_04_colunas}

tabela_04 <- tabela_04 %>%
  mutate ( 
    colunas = 
      case_when(
        conta_contabil_numero %in% c (621200000, 621310000, 621320000, 621330000, 621390000) ~ "receitas",
        conta_contabil_numero %in% c (622920104, 631400000, 632200000) ~ "despesas",
        conta_contabil_numero %in% c (63110000, 63120000, 631510000, 631520000, 631540000, 631530000) ~ "rp_exercicios_anteriores",
        conta_contabil_numero %in% c (218914001, 218924001) ~ "demais_obrigacoes_2189X4001",
        TRUE ~ "escape"
        
      ))


```

```{r}
datatable(tabela_04 %>% group_by(linhas, colunas) %>% summarise(saldo = sum(saldo_r_conta_contabil, na.rm = TRUE)) %>% pivot_wider(names_from = "colunas", values_from = "saldo")%>% relocate(any_of(c("linhas", "receitas", "despesas", "demais_obrigacoes_2189X4001", "rp_exercicios_anteriores", "escape")))%>%
   adorn_totals("row"),
 rownames = FALSE) %>%
  formatRound (
    2:6,
    2,
    mark = ".",
    dec.mark = "," )%>% 
  DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')
   
 
```

#### Receitas (b) União

```{r}
# tabela_04_receitas <- tabela_04 %>%
#   filter(
#            conta_contabil_numero %in% c (621200000, 621310000, 621320000, 621330000, 621390000))%>% 
#   group_by(linha, conta_contabil_numero, conta_contabil_nome, c_con_isf,c_con_tipo_saldo) %>%
#   summarise(saldo = sum(saldo_r_conta_contabil, na.rm = TRUE))
# 
# 
# 
# tabela(tabela_04_receitas %>% group_by(linha) %>% summarise(saldo = sum(saldo)), "saldo")
# tabela(tabela_04_receitas %>% group_by(conta_contabil_numero, c_con_tipo_saldo) %>% summarise(saldo = sum(saldo)), "saldo")
# tabela (tabela_04 %>% filter(linha == "escape") %>%  group_by(fonte_recursos_codigo) %>% summarise(saldo = sum(saldo_r_conta_contabil, na.rm = TRUE)), "saldo")
```

#### Receitas (b) Executivo

```{r tabela_04_receitas_executivo}
# datatable(tabela_04 %>%
#     filter(orgao_uge_poder_codigo == 0 & orgao_uge_orgao_maximo_codigo %notin% c(59000, 29000) &
#         conta_contabil_numero %in% c (621200000, 621310000, 621320000, 621330000, 621390000))%>% 
#     group_by(linha, conta_contabil_numero, conta_contabil_nome, c_con_isf,c_con_tipo_saldo) %>%
#     summarise(saldo = sum(saldo_r_conta_contabil, na.rm = TRUE)))
```

#### Despesas (c)

```{r tabela_04_pagamentos}


# tabela( tabela_04 %>%
#   filter(
#            conta_contabil_numero %in% c (622920104, 631400000, 632200000))%>% 
#   group_by(linha, conta_contabil_numero, conta_contabil_nome, c_con_isf,c_con_tipo_saldo) %>%
#   summarise(saldo = sum(saldo_r_conta_contabil, na.rm = TRUE)) %>% group_by(linha) %>% summarise(saldo = sum(saldo)), "saldo")

```

```{r tabela_04_rp_exercicios_anteriores }

# 
# tabela(tabela_04 %>%
#   filter(conta_contabil_numero %in% c (63110000, 63120000, 631510000, 631520000, 631540000, 631530000))%>% 
#   group_by(linha, conta_contabil_numero, conta_contabil_nome, c_con_isf,c_con_tipo_saldo) %>%
#   summarise(saldo = sum(saldo_r_conta_contabil, na.rm = TRUE)) %>% group_by(linha) %>% summarise(saldo = sum(saldo)), "saldo")
```

```{r tabela_04_rpnp_exec_anteriores}


# tabela(tabela_04 %>%
#   filter(
#            conta_contabil_numero %in% c (63110000, 631200000, 631510000, 631520000, 631540000, 631530000))%>% 
#   group_by(linha, conta_contabil_numero, conta_contabil_nome, c_con_isf,c_con_tipo_saldo) %>%
#   summarise(saldo = sum(saldo_r_conta_contabil, na.rm = TRUE)) %>% group_by(linha) %>% summarise(saldo = sum(saldo)), "saldo")

```

#### e.4. Dedução das Demais Obrigações (2189X4001)

```{r tabela_04_2189x4001_b}


# tabela(tabela_04 %>%
#   filter(
#            conta_contabil_numero %in% c (218914001, 218924001))%>% 
#   group_by(linha, conta_contabil_numero, conta_contabil_nome, c_con_isf,c_con_tipo_saldo) %>%
#   summarise(saldo = sum(saldo_r_conta_contabil, na.rm = TRUE)) %>% group_by(linha) %>% summarise(saldo = sum(saldo)), "saldo")
```

```{r}
#| echo: true
#| eval: false

# Disponibilidade de Caixa
disp_caixa_pos <- c(111110205)

# Recursos a Receber RP
rec_receber_rp_pos <- c(822240101)
rec_receber_rp_neg <- c(822140101)

# Recursos TED
rec_ted_pos <- c(894320000)
rec_ted_neg <- c(894310000)

# Arrecadação Direta
arrec_direta_pos <- c(111130001)

# Restos a Pagar Liquidados e Não Pagos - De Exercícios Anteriores
rp_liq_nao_pagos_ant_pos <- c(632100000, 631300000)

# Restos a Pagar Liquidados e Não Pagos - Do Exercício
rp_liq_nao_pagos_exe_pos <- c(632710000)

# Restos a Pagar Empenhados e Não Liquidados de Exercícios Anteriores
rp_emp_nao_liq_ant_pos <- c(631100000, 631200000, 631510000, 631520000, 631530000, 631540000)

# Demais Obrigações Financeiras
demais_obrig_pos <- c(200000000)
demais_obrig_neg <- c(218914001, 218924001, 631200000, 631520000, 
                      631540000, 631300000, 632100000, 632710000, 531720100)

# Recursos a Liberar RP
rec_liberar_rp_pos <- c(822140101)
rec_liberar_rp_neg <- c(822240101)

# Recursos TED a Liberar
rec_ted_liberar_pos <- c(894310000)
rec_ted_liberar_neg <- c(894320000)

# Restos a Pagar Empenhados e Não Liquidados do Exercício
rp_emp_nao_liq_exe_pos <- c(531710100, 531720100)

# Empenhos Não Liquidados Cancelados
emp_nao_liq_canc_pos <- c(631910000)
```

#### RPP de Exercícios Anteriores (f)

```{r tabela_04_2189x4001_executivo}

# 
# tabela(tabela_04 %>%
#   filter(orgao_uge_poder_codigo == "0" &
#          orgao_uge_orgao_maximo_codigo %notin% c(59000,29000)&
#            conta_contabil_numero %in% c (632100000, 631300000))%>% 
#   group_by(linha, conta_contabil_numero, conta_contabil_nome, c_con_isf,c_con_tipo_saldo) %>%
#   summarise(saldo = sum(saldo_r_conta_contabil, na.rm = TRUE)) %>% group_by(linha) %>% summarise(saldo = sum(saldo)), "saldo")
```

#### RPNP do Exercício

```{r tabela_04_rpnp_exercicio}

# 
# tabela(tabela_04 %>%
#   filter(orgao_uge_poder_codigo == "0" &
#          orgao_uge_orgao_maximo_codigo %notin% c(59000,29000)&
#            conta_contabil_numero %in% c (531710100, 531720100))%>% 
#   group_by(linha, conta_contabil_numero, conta_contabil_nome, c_con_isf,c_con_tipo_saldo) %>%
#   summarise(saldo = sum(saldo_r_conta_contabil, na.rm = TRUE)) %>% group_by(linha) %>% summarise(saldo = sum(saldo)), "saldo")
```

### Anexo 12

#### Restos a pagar

```{r}
# dados_anexo_12_rp <- read_excel("dados_2024_rp_anexo_12.xlsx") %>% clean_names()

datatable(dados_anexo_12_rp %>% group_by(mes_lancamento) %>% filter( iduso_codigo == 6, fonte_recursos_codigo %notin% c("45", "79"), grupo_despesa_codigo_grupo %notin% c(2,6), programa_governo_codigo %notin% c("0089" , "2019")) %>% pivot_wider(names_from = item_informacao, values_from = saldo_r_item_informacao) %>% summarise_at(itens_anexo_12_rp, sum, na.rm = TRUE) %>% adorn_totals("row"), rownames = FALSE,
  )%>% formatRound(itens_anexo_12_rp, 2, mark = ".", dec.mark = "," )%>% 
  DT::formatStyle(columns = colnames(.$x$data), fontSize = '75%')





```

### Anexo 07

#### Restos a pagar

```{r anexo_07}
# dados_2024_rp_anexo_07 <- read_excel("dados_2024_rp_anexo_07.xlsx") %>% clean_names()

dados_rp_anexo_07 <- dados_rp_anexo_07 %>%  
    mutate (
      tipo_modalidade = ifelse(modalidade_aplicacao_codigo == 91, "intra", "exceto intra"))


tabela(dados_rp_anexo_07 %>% group_by( orgao_uge_orgao_maximo_codigo, orgao_uge_orgao_maximo_nome) %>% filter(tipo_modalidade == "intra") %>% summarise(rpnp_pagos = sum(rpnp_pagos, na.rm = TRUE)/1000), "rpnp_pagos")
```

Contas contábeis:

111110200, 111110201, 111110202, 111110203, 111110205, 111110206, 111110207, 111110300, 111110301, 111110302, 111110303, 111110400, 111110401, 111110402, 111110403, 111110404, 111110500, 111110501, 111110502, 111110503, 111110504, 111110600, 111111900, 111111901, 111111902, 111111903, 111111904, 111111905, 111111906, 111111907, 111111908, 111111999, 111112000, 111112001, 111112002, 111113000, 111113001, 111113002, 111115000, 111115000, 111115001, 111115002, 111115003, 111115004, 111115005, 111115005, 111115006, 111115007, 111115008, 111115009, 111115010, 111115011, 111115011, 111115012, 111115012, 111115013, 111115099, 111215100, 112410100, 112410301, 112410303, 112410401, 112410600, 112440100, 112440301, 112440303, 112440400, 112440600, 112450100, 112450301, 112450303, 112450401, 112450600, 112910401, 112940401, 112950401, 113813001, 113813002, 121110301, 121110308, 121110314, 121110318, 121119902, 121119904, 121140301, 121140308, 121140318, 121149904, 121150301, 121150308, 121150318, 121159904, 121249818, 211110101, 211210100, 211419800, 211449800, 211459800, 212110202, 212110301, 212110303, 212110700, 212140301, 212140303, 212150301, 212150303, 212210300, 212210601, 212310201, 212310202, 212410201, 212510103, 212540103, 212550103, 213110400, 213140400, 213150400, 214119900, 217310301, 217310602, 217350402, 218912600, 218912901, 218912902, 218942902, 218952902, 222110102, 222110200, 222210200, 222310101, 222310102, 222410101, 223110100, 227310301, 227310401, 228911600, 237110300, 237140300, 237150300, 343110100, 343210200, 343310100, 343410200, 343910103, 343940103, 343950103, 348110100, 361710400, 361740400, 361750400, 364010100, 443110100, 443140100, 443150100, 443310100, 443910100, 443910101, 443910200, 443940100, 443940101, 443940200, 443950100, 443950101, 443950200, 445110100, 445210100, 448110100, 449010100, 449040100, 449050100, 464010100, 464040100, 464050100, 497110100, 497140100, 497150100, 497240100, 522110101, 522110201, 522110209, 522120101, 522120103, 522120201, 522120202, 522120203, 522120301, 522120302, 522120303, 522190100, 522190101, 522190109, 522190201, 522190209, 522190300, 522190301, 522190309, 522190400, 622130300, 622920103, 622920107, 631100000, 631200000, 631300000, 631510000, 631520000, 632100000, 899913900, 899913901, 899913902, 899913903, 899913904, 899913905, 899913906, 899913907, 899913908
